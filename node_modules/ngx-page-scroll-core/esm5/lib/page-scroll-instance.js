/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * An Interface specifying the possible options to be passed into the newInstance() factory method
 * @record
 */
export function PageScrollOptions() { }
if (false) {
    /**
     * The document object of the current app
     * @type {?}
     */
    PageScrollOptions.prototype.document;
    /**
     * A specification of the DOM element to scroll to. Either a string referring to an
     * element using a valid css selector (`#target`, `.class`, `div.class`) or a HTMLElement
     * that is attached to the document's DOM tree.
     * @type {?}
     */
    PageScrollOptions.prototype.scrollTarget;
    /**
     * Array of HTMLElements or the body object that should be manipulated while performing
     * the scroll animation.
     * @type {?|undefined}
     */
    PageScrollOptions.prototype.scrollViews;
    /**
     * Maximum speed to be used for the scroll animation. Only taken
     * into account of no duration is provided
     * @type {?|undefined}
     */
    PageScrollOptions.prototype.speed;
    /**
     * A listener to be called whenever the scroll animation stops
     * @type {?|undefined}
     */
    PageScrollOptions.prototype.scrollFinishListener;
    /** @type {?|undefined} */
    PageScrollOptions.prototype.namespace;
    /** @type {?|undefined} */
    PageScrollOptions.prototype.verticalScrolling;
    /** @type {?|undefined} */
    PageScrollOptions.prototype.duration;
    /** @type {?|undefined} */
    PageScrollOptions.prototype.scrollOffset;
    /** @type {?|undefined} */
    PageScrollOptions.prototype.advancedInlineOffsetCalculation;
    /** @type {?|undefined} */
    PageScrollOptions.prototype.interruptEvents;
    /** @type {?|undefined} */
    PageScrollOptions.prototype.interruptKeys;
    /** @type {?|undefined} */
    PageScrollOptions.prototype.interruptible;
    /** @type {?|undefined} */
    PageScrollOptions.prototype.scrollInView;
    /** @type {?|undefined} */
    PageScrollOptions.prototype.easingLogic;
}
/**
 * Represents a scrolling action
 */
var /**
 * Represents a scrolling action
 */
PageScrollInstance = /** @class */ (function () {
    /**
     * Private constructor, requires the properties assumed to be the bare minimum.
     * Use the factory methods to create instances:
     *      {@link PageScrollService#create}
     */
    function PageScrollInstance(pageScrollOptions) {
        /**
         * These properties will be set/manipulated if the scroll animation starts
         */
        /* The initial value of the scrollTop or scrollLeft position when the animation starts */
        this.startScrollPosition = 0;
        /* Whether an interrupt listener is attached to the body or not */
        this.interruptListenersAttached = false;
        /* References to the timer instance that is used to perform the scroll animation to be
           able to clear it on animation end*/
        this.timer = null;
        if (!pageScrollOptions.scrollViews || pageScrollOptions.scrollViews.length === 0) {
            pageScrollOptions.scrollViews = [
                pageScrollOptions.document.documentElement,
                pageScrollOptions.document.body,
                pageScrollOptions.document.body.parentNode,
            ];
            this.isInlineScrolling = false;
        }
        else {
            this.isInlineScrolling = true;
        }
        this.pageScrollOptions = pageScrollOptions;
    }
    /**
     * @private
     * @param {?} pageScrollOptions
     * @param {?} scrollTargetElement
     * @return {?}
     */
    PageScrollInstance.getScrollingTargetPosition = /**
     * @private
     * @param {?} pageScrollOptions
     * @param {?} scrollTargetElement
     * @return {?}
     */
    function (pageScrollOptions, scrollTargetElement) {
        /** @type {?} */
        var body = pageScrollOptions.document.body;
        /** @type {?} */
        var docEl = pageScrollOptions.document.documentElement;
        /** @type {?} */
        var windowPageYOffset = pageScrollOptions.document.defaultView &&
            pageScrollOptions.document.defaultView.pageYOffset || undefined;
        /** @type {?} */
        var windowPageXOffset = pageScrollOptions.document.defaultView &&
            pageScrollOptions.document.defaultView.pageXOffset || undefined;
        /** @type {?} */
        var scrollTop = windowPageYOffset || docEl.scrollTop || body.scrollTop;
        /** @type {?} */
        var scrollLeft = windowPageXOffset || docEl.scrollLeft || body.scrollLeft;
        /** @type {?} */
        var clientTop = docEl.clientTop || body.clientTop || 0;
        /** @type {?} */
        var clientLeft = docEl.clientLeft || body.clientLeft || 0;
        if (scrollTargetElement === undefined || scrollTargetElement === null) {
            // No element found, so return the current position to not cause any change in scroll position
            return { top: scrollTop, left: scrollLeft };
        }
        /** @type {?} */
        var box = scrollTargetElement.getBoundingClientRect();
        /** @type {?} */
        var top = box.top + scrollTop - clientTop;
        /** @type {?} */
        var left = box.left + scrollLeft - clientLeft;
        return { top: Math.round(top), left: Math.round(left) };
    };
    /**
     * @private
     * @param {?} pageScrollOptions
     * @param {?} scrollTargetElement
     * @return {?}
     */
    PageScrollInstance.getInlineScrollingTargetPosition = /**
     * @private
     * @param {?} pageScrollOptions
     * @param {?} scrollTargetElement
     * @return {?}
     */
    function (pageScrollOptions, scrollTargetElement) {
        /** @type {?} */
        var position = { top: scrollTargetElement.offsetTop, left: scrollTargetElement.offsetLeft };
        if (pageScrollOptions.advancedInlineOffsetCalculation && pageScrollOptions.scrollViews.length === 1) {
            /** @type {?} */
            var accumulatedParentsPos = { top: 0, left: 0 };
            // not named window to make sure we're not getting the global window variable by accident
            /** @type {?} */
            var theWindow = scrollTargetElement.ownerDocument.defaultView;
            /** @type {?} */
            var parentFound = false;
            // Start parent is the immediate parent
            /** @type {?} */
            var parent_1 = scrollTargetElement.parentElement;
            // Iterate upwards all parents
            while (!parentFound && parent_1 !== undefined && parent_1 !== null) {
                if (theWindow.getComputedStyle(parent_1).getPropertyValue('position') === 'relative') {
                    accumulatedParentsPos.top += parent_1.offsetTop;
                    accumulatedParentsPos.left += parent_1.offsetLeft;
                }
                // Next iteration
                parent_1 = parent_1.parentElement;
                parentFound = parent_1 === pageScrollOptions.scrollViews[0];
            }
            if (parentFound) {
                // Only use the results if we found the parent, otherwise we accumulated too much anyway
                position.top += accumulatedParentsPos.top;
                position.left += accumulatedParentsPos.left;
            }
            else {
                /* TODO Uncomment
                if (PageScrollConfig._logLevel >= 2 || (PageScrollConfig._logLevel >= 1 && isDevMode())) {
                  console.warn('Unable to find nested scrolling targets parent!');
                }*/
            }
        }
        return position;
    };
    /**
     * @param {?} scrollingView
     * @return {?}
     */
    PageScrollInstance.prototype.getScrollPropertyValue = /**
     * @param {?} scrollingView
     * @return {?}
     */
    function (scrollingView) {
        if (!this.pageScrollOptions.verticalScrolling) {
            return scrollingView.scrollLeft;
        }
        return scrollingView.scrollTop;
    };
    /**
     * @param {?} scrollingView
     * @return {?}
     */
    PageScrollInstance.prototype.getScrollClientPropertyValue = /**
     * @param {?} scrollingView
     * @return {?}
     */
    function (scrollingView) {
        if (!this.pageScrollOptions.verticalScrolling) {
            return scrollingView.clientWidth;
        }
        return scrollingView.clientHeight;
    };
    /**
     * Extract the exact location of the scrollTarget element.
     *
     * Extract the scrollTarget HTMLElement from the given PageScrollTarget object. The latter one may be
     * a string like "#heading2", then this method returns the corresponding DOM element for that id.
     *
     */
    /**
     * Extract the exact location of the scrollTarget element.
     *
     * Extract the scrollTarget HTMLElement from the given PageScrollTarget object. The latter one may be
     * a string like "#heading2", then this method returns the corresponding DOM element for that id.
     *
     * @return {?}
     */
    PageScrollInstance.prototype.extractScrollTargetPosition = /**
     * Extract the exact location of the scrollTarget element.
     *
     * Extract the scrollTarget HTMLElement from the given PageScrollTarget object. The latter one may be
     * a string like "#heading2", then this method returns the corresponding DOM element for that id.
     *
     * @return {?}
     */
    function () {
        /** @type {?} */
        var scrollTargetElement = this.getScrollTargetElement();
        if (scrollTargetElement === null || scrollTargetElement === undefined) {
            // Scroll target not found
            return { top: NaN, left: NaN };
        }
        if (this.isInlineScrolling) {
            return PageScrollInstance.getInlineScrollingTargetPosition(this.pageScrollOptions, scrollTargetElement);
        }
        return PageScrollInstance.getScrollingTargetPosition(this.pageScrollOptions, scrollTargetElement);
    };
    /**
     * Get the top offset of the scroll animation.
     * This automatically takes the offset location of the scrolling container/scrolling view
     * into account (for nested/inline scrolling).
     */
    /**
     * Get the top offset of the scroll animation.
     * This automatically takes the offset location of the scrolling container/scrolling view
     * into account (for nested/inline scrolling).
     * @return {?}
     */
    PageScrollInstance.prototype.getCurrentOffset = /**
     * Get the top offset of the scroll animation.
     * This automatically takes the offset location of the scrolling container/scrolling view
     * into account (for nested/inline scrolling).
     * @return {?}
     */
    function () {
        return this.pageScrollOptions.scrollOffset;
    };
    /**
     * Sets the "scrollTop" or "scrollLeft" property for all scrollViews to the provided value
     * @return true if at least for one ScrollTopSource the scrollTop/scrollLeft value could be set and it kept the new value.
     *          false if it failed for all ScrollViews, meaning that we should stop the animation
     *          (probably because we're at the end of the scrolling region)
     */
    /**
     * Sets the "scrollTop" or "scrollLeft" property for all scrollViews to the provided value
     * @param {?} position
     * @return {?} true if at least for one ScrollTopSource the scrollTop/scrollLeft value could be set and it kept the new value.
     *          false if it failed for all ScrollViews, meaning that we should stop the animation
     *          (probably because we're at the end of the scrolling region)
     */
    PageScrollInstance.prototype.setScrollPosition = /**
     * Sets the "scrollTop" or "scrollLeft" property for all scrollViews to the provided value
     * @param {?} position
     * @return {?} true if at least for one ScrollTopSource the scrollTop/scrollLeft value could be set and it kept the new value.
     *          false if it failed for all ScrollViews, meaning that we should stop the animation
     *          (probably because we're at the end of the scrolling region)
     */
    function (position) {
        var _this = this;
        // Set the new scrollTop/scrollLeft to all scrollViews elements
        return this.pageScrollOptions.scrollViews.reduce((/**
         * @param {?} oneAlreadyWorked
         * @param {?} scrollingView
         * @return {?}
         */
        function (oneAlreadyWorked, scrollingView) {
            /** @type {?} */
            var startScrollPropertyValue = _this.getScrollPropertyValue(scrollingView);
            if (scrollingView && startScrollPropertyValue !== undefined && startScrollPropertyValue !== null) {
                /** @type {?} */
                var scrollDistance = Math.abs(startScrollPropertyValue - position);
                // The movement we need to perform is less than 2px
                // This we consider a small movement which some browser may not perform when
                // changing the scrollTop/scrollLeft property
                // Thus in this cases we do not stop the scroll animation, although setting the
                // scrollTop/scrollLeft value "fails"
                /** @type {?} */
                var isSmallMovement = scrollDistance < _this.pageScrollOptions._minScrollDistance;
                if (!_this.pageScrollOptions.verticalScrolling) {
                    scrollingView.scrollLeft = position;
                }
                else {
                    scrollingView.scrollTop = position;
                }
                // Return true if setting the new scrollTop/scrollLeft value worked
                // We consider that it worked if the new scrollTop/scrollLeft value is closer to the
                // desired scrollTop/scrollLeft than before (it might not be exactly the value we
                // set due to dpi or rounding irregularities)
                if (isSmallMovement || scrollDistance > Math.abs(_this.getScrollPropertyValue(scrollingView) - position)) {
                    return true;
                }
            }
            return oneAlreadyWorked;
        }), false);
    };
    /**
     * Trigger firing a animation finish event
     * @param value Whether the animation finished at the target (true) or got interrupted (false)
     */
    /**
     * Trigger firing a animation finish event
     * @param {?} value Whether the animation finished at the target (true) or got interrupted (false)
     * @return {?}
     */
    PageScrollInstance.prototype.fireEvent = /**
     * Trigger firing a animation finish event
     * @param {?} value Whether the animation finished at the target (true) or got interrupted (false)
     * @return {?}
     */
    function (value) {
        if (this.pageScrollOptions.scrollFinishListener) {
            this.pageScrollOptions.scrollFinishListener.emit(value);
        }
    };
    /**
     * Attach the interrupt listeners to the PageScrollInstance body. The given interruptReporter
     * will be called if any of the attached events is fired.
     *
     * Possibly attached interruptListeners are automatically removed from the body before the new one will be attached.
     */
    /**
     * Attach the interrupt listeners to the PageScrollInstance body. The given interruptReporter
     * will be called if any of the attached events is fired.
     *
     * Possibly attached interruptListeners are automatically removed from the body before the new one will be attached.
     * @param {?} interruptReporter
     * @return {?}
     */
    PageScrollInstance.prototype.attachInterruptListeners = /**
     * Attach the interrupt listeners to the PageScrollInstance body. The given interruptReporter
     * will be called if any of the attached events is fired.
     *
     * Possibly attached interruptListeners are automatically removed from the body before the new one will be attached.
     * @param {?} interruptReporter
     * @return {?}
     */
    function (interruptReporter) {
        var _this = this;
        if (this.interruptListenersAttached) {
            // Detach possibly existing listeners first
            this.detachInterruptListeners();
        }
        this.interruptListener = (/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            interruptReporter.report(event, _this);
        });
        this.pageScrollOptions.interruptEvents.forEach((/**
         * @param {?} event
         * @return {?}
         */
        function (event) { return _this.pageScrollOptions.document.body.addEventListener(event, _this.interruptListener); }));
        this.interruptListenersAttached = true;
    };
    /**
     * Remove event listeners from the body and stop listening for events that might be treated as "animation
     * interrupt" events.
     */
    /**
     * Remove event listeners from the body and stop listening for events that might be treated as "animation
     * interrupt" events.
     * @return {?}
     */
    PageScrollInstance.prototype.detachInterruptListeners = /**
     * Remove event listeners from the body and stop listening for events that might be treated as "animation
     * interrupt" events.
     * @return {?}
     */
    function () {
        var _this = this;
        this.pageScrollOptions.interruptEvents.forEach((/**
         * @param {?} event
         * @return {?}
         */
        function (event) { return _this.pageScrollOptions.document.body.removeEventListener(event, _this.interruptListener); }));
        this.interruptListenersAttached = false;
    };
    /**
     * @private
     * @return {?}
     */
    PageScrollInstance.prototype.getScrollTargetElement = /**
     * @private
     * @return {?}
     */
    function () {
        if (typeof this.pageScrollOptions.scrollTarget === 'string') {
            /** @type {?} */
            var targetSelector = (/** @type {?} */ (this.pageScrollOptions.scrollTarget));
            if (targetSelector.match(/^#[^\s]+$/g) !== null) {
                // It's an id selector and a valid id, as it does not contain any white space characters
                return this.pageScrollOptions.document.getElementById(targetSelector.substr(1));
            }
            return (/** @type {?} */ (this.pageScrollOptions.document.querySelector(targetSelector)));
        }
        return (/** @type {?} */ (this.pageScrollOptions.scrollTarget));
    };
    return PageScrollInstance;
}());
/**
 * Represents a scrolling action
 */
export { PageScrollInstance };
if (false) {
    /** @type {?} */
    PageScrollInstance.prototype.pageScrollOptions;
    /**
     * @type {?}
     * @private
     */
    PageScrollInstance.prototype.isInlineScrolling;
    /**
     * @type {?}
     * @private
     */
    PageScrollInstance.prototype.interruptListener;
    /**
     * These properties will be set/manipulated if the scroll animation starts
     * @type {?}
     */
    PageScrollInstance.prototype.startScrollPosition;
    /** @type {?} */
    PageScrollInstance.prototype.targetScrollPosition;
    /** @type {?} */
    PageScrollInstance.prototype.distanceToScroll;
    /** @type {?} */
    PageScrollInstance.prototype.startTime;
    /** @type {?} */
    PageScrollInstance.prototype.endTime;
    /** @type {?} */
    PageScrollInstance.prototype.executionDuration;
    /** @type {?} */
    PageScrollInstance.prototype.interruptListenersAttached;
    /** @type {?} */
    PageScrollInstance.prototype.timer;
}
/**
 * An Interface a listener should implement to be notified about possible interrupt events
 * that happened due to user interaction while a scroll animation takes place.
 *
 * The PageScrollService provides an implementation to a PageScrollInstance to be notified
 * about scroll animation interrupts and stop related animations.
 * @record
 */
export function InterruptReporter() { }
if (false) {
    /**
     * @param {?} event
     * @param {?} pageScrollInstance
     * @return {?}
     */
    InterruptReporter.prototype.report = function (event, pageScrollInstance) { };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFnZS1zY3JvbGwtaW5zdGFuY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtcGFnZS1zY3JvbGwtY29yZS8iLCJzb3VyY2VzIjpbImxpYi9wYWdlLXNjcm9sbC1pbnN0YW5jZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQVNBLHVDQXdDQzs7Ozs7O0lBcENDLHFDQUFtQjs7Ozs7OztJQU9uQix5Q0FBK0I7Ozs7OztJQU0vQix3Q0FBZ0M7Ozs7OztJQU1oQyxrQ0FBZTs7Ozs7SUFLZixpREFBNkM7O0lBRTdDLHNDQUFtQjs7SUFDbkIsOENBQTRCOztJQUM1QixxQ0FBa0I7O0lBQ2xCLHlDQUFzQjs7SUFDdEIsNERBQTBDOztJQUMxQyw0Q0FBMkI7O0lBQzNCLDBDQUF5Qjs7SUFDekIsMENBQXdCOztJQUN4Qix5Q0FBdUI7O0lBQ3ZCLHdDQUEwQjs7Ozs7QUFNNUI7Ozs7SUFnQ0U7Ozs7T0FJRztJQUNILDRCQUFZLGlCQUFvQzs7Ozs7UUF2QnpDLHdCQUFtQixHQUFHLENBQUMsQ0FBQzs7UUFZeEIsK0JBQTBCLEdBQUcsS0FBSyxDQUFDOzs7UUFJbkMsVUFBSyxHQUFRLElBQUksQ0FBQztRQVF2QixJQUFJLENBQUMsaUJBQWlCLENBQUMsV0FBVyxJQUFJLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQ2hGLGlCQUFpQixDQUFDLFdBQVcsR0FBRztnQkFDOUIsaUJBQWlCLENBQUMsUUFBUSxDQUFDLGVBQWU7Z0JBQzFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxJQUFJO2dCQUMvQixpQkFBaUIsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVU7YUFDM0MsQ0FBQztZQUNGLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxLQUFLLENBQUM7U0FDaEM7YUFBTTtZQUNMLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUM7U0FDL0I7UUFFRCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsaUJBQWlCLENBQUM7SUFD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QUMsRUFBdkYsQ0FBdUYsRUFDM0csQ0FBQztRQUNGLElBQUksQ0FBQywwQkFBMEIsR0FBRyxLQUFLLENBQUM7SUFDMUMsQ0FBQzs7Ozs7SUFFTyxtREFBc0I7Ozs7SUFBOUI7UUFDRSxJQUFJLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLFlBQVksS0FBSyxRQUFRLEVBQUU7O2dCQUNyRCxjQUFjLEdBQUcsbUJBQVEsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFlBQVksRUFBQTtZQUNsRSxJQUFJLGNBQWMsQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLEtBQUssSUFBSSxFQUFFO2dCQUMvQyx3RkFBd0Y7Z0JBRXhGLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ2pGO1lBRUQsT0FBTyxtQkFBYSxJQUFJLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsRUFBQSxDQUFDO1NBQ25GO1FBRUQsT0FBTyxtQkFBYSxJQUFJLENBQUMsaUJBQWlCLENBQUMsWUFBWSxFQUFBLENBQUM7SUFDMUQsQ0FBQztJQUNILHlCQUFDO0FBQUQsQ0FBQyxBQWxRRCxJQWtRQzs7Ozs7OztJQWhRQywrQ0FBNEM7Ozs7O0lBRTVDLCtDQUFtQzs7Ozs7SUFJbkMsK0NBQThEOzs7OztJQU05RCxpREFBK0I7O0lBRS9CLGtEQUFvQzs7SUFFcEMsOENBQWdDOztJQUVoQyx1Q0FBeUI7O0lBRXpCLHFDQUF1Qjs7SUFFdkIsK0NBQWlDOztJQUVqQyx3REFBMEM7O0lBSTFDLG1DQUF5Qjs7Ozs7Ozs7OztBQTZPM0IsdUNBRUM7Ozs7Ozs7SUFEQyw4RUFBbUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFBhZ2VTY3JvbGxDb25maWcgfSBmcm9tICcuL3R5cGVzL3BhZ2Utc2Nyb2xsLmNvbmZpZyc7XG5pbXBvcnQgeyBQYWdlU2Nyb2xsVGFyZ2V0IH0gZnJvbSAnLi90eXBlcy9wYWdlLXNjcm9sbC10YXJnZXQnO1xuaW1wb3J0IHsgUGFnZVNjcm9sbFZpZXdzIH0gZnJvbSAnLi90eXBlcy9wYWdlLXNjcm9sbC12aWV3JztcbmltcG9ydCB7IEVhc2luZ0xvZ2ljIH0gZnJvbSAnLi90eXBlcy9lYXNpbmctbG9naWMnO1xuXG4vKipcbiAqIEFuIEludGVyZmFjZSBzcGVjaWZ5aW5nIHRoZSBwb3NzaWJsZSBvcHRpb25zIHRvIGJlIHBhc3NlZCBpbnRvIHRoZSBuZXdJbnN0YW5jZSgpIGZhY3RvcnkgbWV0aG9kXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUGFnZVNjcm9sbE9wdGlvbnMgZXh0ZW5kcyBQYWdlU2Nyb2xsQ29uZmlnIHtcbiAgLyoqXG4gICAqIFRoZSBkb2N1bWVudCBvYmplY3Qgb2YgdGhlIGN1cnJlbnQgYXBwXG4gICAqL1xuICBkb2N1bWVudDogRG9jdW1lbnQ7XG5cbiAgLyoqXG4gICAqIEEgc3BlY2lmaWNhdGlvbiBvZiB0aGUgRE9NIGVsZW1lbnQgdG8gc2Nyb2xsIHRvLiBFaXRoZXIgYSBzdHJpbmcgcmVmZXJyaW5nIHRvIGFuXG4gICAqIGVsZW1lbnQgdXNpbmcgYSB2YWxpZCBjc3Mgc2VsZWN0b3IgKGAjdGFyZ2V0YCwgYC5jbGFzc2AsIGBkaXYuY2xhc3NgKSBvciBhIEhUTUxFbGVtZW50XG4gICAqIHRoYXQgaXMgYXR0YWNoZWQgdG8gdGhlIGRvY3VtZW50J3MgRE9NIHRyZWUuXG4gICAqL1xuICBzY3JvbGxUYXJnZXQ6IFBhZ2VTY3JvbGxUYXJnZXQ7XG5cbiAgLyoqXG4gICAqIEFycmF5IG9mIEhUTUxFbGVtZW50cyBvciB0aGUgYm9keSBvYmplY3QgdGhhdCBzaG91bGQgYmUgbWFuaXB1bGF0ZWQgd2hpbGUgcGVyZm9ybWluZ1xuICAgKiB0aGUgc2Nyb2xsIGFuaW1hdGlvbi5cbiAgICovXG4gIHNjcm9sbFZpZXdzPzogUGFnZVNjcm9sbFZpZXdzW107XG5cbiAgLyoqXG4gICAqIE1heGltdW0gc3BlZWQgdG8gYmUgdXNlZCBmb3IgdGhlIHNjcm9sbCBhbmltYXRpb24uIE9ubHkgdGFrZW5cbiAgICogaW50byBhY2NvdW50IG9mIG5vIGR1cmF0aW9uIGlzIHByb3ZpZGVkXG4gICAqL1xuICBzcGVlZD86IG51bWJlcjtcblxuICAvKipcbiAgICogQSBsaXN0ZW5lciB0byBiZSBjYWxsZWQgd2hlbmV2ZXIgdGhlIHNjcm9sbCBhbmltYXRpb24gc3RvcHNcbiAgICovXG4gIHNjcm9sbEZpbmlzaExpc3RlbmVyPzogRXZlbnRFbWl0dGVyPGJvb2xlYW4+O1xuXG4gIG5hbWVzcGFjZT86IHN0cmluZztcbiAgdmVydGljYWxTY3JvbGxpbmc/OiBib29sZWFuO1xuICBkdXJhdGlvbj86IG51bWJlcjtcbiAgc2Nyb2xsT2Zmc2V0PzogbnVtYmVyO1xuICBhZHZhbmNlZElubGluZU9mZnNldENhbGN1bGF0aW9uPzogYm9vbGVhbjtcbiAgaW50ZXJydXB0RXZlbnRzPzogc3RyaW5nW107XG4gIGludGVycnVwdEtleXM/OiBzdHJpbmdbXTtcbiAgaW50ZXJydXB0aWJsZT86IGJvb2xlYW47XG4gIHNjcm9sbEluVmlldz86IGJvb2xlYW47XG4gIGVhc2luZ0xvZ2ljPzogRWFzaW5nTG9naWM7XG59XG5cbi8qKlxuICogUmVwcmVzZW50cyBhIHNjcm9sbGluZyBhY3Rpb25cbiAqL1xuZXhwb3J0IGNsYXNzIFBhZ2VTY3JvbGxJbnN0YW5jZSB7XG5cbiAgcHVibGljIHBhZ2VTY3JvbGxPcHRpb25zOiBQYWdlU2Nyb2xsT3B0aW9ucztcblxuICBwcml2YXRlIGlzSW5saW5lU2Nyb2xsaW5nOiBib29sZWFuO1xuXG4gIC8qIFRoZSBsaXN0ZW5lciB0aGF0IHRoaXMgc2Nyb2xsIGluc3RhbmNlIGF0dGFjaGVzIHRvIHRoZSBib2R5IHRvIGxpc3RlbiBmb3IgaW50ZXJydXB0IGV2ZW50c1xuICBXZSdyZSBrZWVwaW5nIGEgcmVmZXJlbmNlIHRvIGl0IHNvIHdlIGNhbiBwcm9wZXJseSByZW1vdmUgaXQgd2hlbiB0aGUgYW5pbWF0aW9uIGZpbmlzaGVzICovXG4gIHByaXZhdGUgaW50ZXJydXB0TGlzdGVuZXI6IEV2ZW50TGlzdGVuZXJPckV2ZW50TGlzdGVuZXJPYmplY3Q7XG5cbiAgLyoqXG4gICAqIFRoZXNlIHByb3BlcnRpZXMgd2lsbCBiZSBzZXQvbWFuaXB1bGF0ZWQgaWYgdGhlIHNjcm9sbCBhbmltYXRpb24gc3RhcnRzXG4gICAqL1xuICAvKiBUaGUgaW5pdGlhbCB2YWx1ZSBvZiB0aGUgc2Nyb2xsVG9wIG9yIHNjcm9sbExlZnQgcG9zaXRpb24gd2hlbiB0aGUgYW5pbWF0aW9uIHN0YXJ0cyAqL1xuICBwdWJsaWMgc3RhcnRTY3JvbGxQb3NpdGlvbiA9IDA7XG4gIC8qIFRoZSB0YXJnZXQgdmFsdWUgb2YgdGhlIHNjcm9sbFRvcCBvciBzY3JvbGxMZWZ0IHBvc2l0aW9uIGZvciB0aGUgYW5pbWF0aW9uIChha2EgXCJ0aGUgZmluYWwgZGVzdGluYXRpb25cIikgKi9cbiAgcHVibGljIHRhcmdldFNjcm9sbFBvc2l0aW9uOiBudW1iZXI7XG4gIC8qIERpZmZlcmVuY2UgYmV0d2VlbiBzdGFydFNjcm9sbFBvc2l0aW9uIGFuZCB0YXJnZXRTY3JvbGxQb3NpdGlvbi4gUHJlLWNhbGN1bGF0ZWQgdG8gbWluaW1pemUgY29tcHV0YXRpb25zIGR1cmluZyBhbmltYXRpb24gKi9cbiAgcHVibGljIGRpc3RhbmNlVG9TY3JvbGw6IG51bWJlcjtcbiAgLyogVGhlIHRpbWVzdGFtcCB3aGVuIHRoZSBhbmltYXRpb24gc3RhcnRzL2dvdCBzdGFydGVkICovXG4gIHB1YmxpYyBzdGFydFRpbWU6IG51bWJlcjtcbiAgLyogVGhlIGVzdGltYXRlIGVuZCB0aW1lIG9mIHRoZSBhbmltYXRpb24sIGNhbGN1bGF0ZWQgYnkgc3RhcnRUaW1lICsgZHVyYXRpb24gKi9cbiAgcHVibGljIGVuZFRpbWU6IG51bWJlcjtcbiAgLyogVGhlIGR1cmF0aW9uIGEgc3RhcnRlZCBhbmltYXRpb24gdGFrZXMuIFRoaXMgbWF5IG1hdGNoIHRoZSBfZHVyYXRpb24gb3IgYmUgYWRqdXN0ZWQgZHVlIHRvIHRoZSBfc3BlZWQgb3B0aW9uICovXG4gIHB1YmxpYyBleGVjdXRpb25EdXJhdGlvbjogbnVtYmVyO1xuICAvKiBXaGV0aGVyIGFuIGludGVycnVwdCBsaXN0ZW5lciBpcyBhdHRhY2hlZCB0byB0aGUgYm9keSBvciBub3QgKi9cbiAgcHVibGljIGludGVycnVwdExpc3RlbmVyc0F0dGFjaGVkID0gZmFsc2U7XG5cbiAgLyogUmVmZXJlbmNlcyB0byB0aGUgdGltZXIgaW5zdGFuY2UgdGhhdCBpcyB1c2VkIHRvIHBlcmZvcm0gdGhlIHNjcm9sbCBhbmltYXRpb24gdG8gYmVcbiAgIGFibGUgdG8gY2xlYXIgaXQgb24gYW5pbWF0aW9uIGVuZCovXG4gIHB1YmxpYyB0aW1lcjogYW55ID0gbnVsbDtcblxuICAvKipcbiAgICogUHJpdmF0ZSBjb25zdHJ1Y3RvciwgcmVxdWlyZXMgdGhlIHByb3BlcnRpZXMgYXNzdW1lZCB0byBiZSB0aGUgYmFyZSBtaW5pbXVtLlxuICAgKiBVc2UgdGhlIGZhY3RvcnkgbWV0aG9kcyB0byBjcmVhdGUgaW5zdGFuY2VzOlxuICAgKiAgICAgIHtAbGluayBQYWdlU2Nyb2xsU2VydmljZSNjcmVhdGV9XG4gICAqL1xuICBjb25zdHJ1Y3RvcihwYWdlU2Nyb2xsT3B0aW9uczogUGFnZVNjcm9sbE9wdGlvbnMpIHtcbiAgICBpZiAoIXBhZ2VTY3JvbGxPcHRpb25zLnNjcm9sbFZpZXdzIHx8IHBhZ2VTY3JvbGxPcHRpb25zLnNjcm9sbFZpZXdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcGFnZVNjcm9sbE9wdGlvbnMuc2Nyb2xsVmlld3MgPSBbXG4gICAgICAgIHBhZ2VTY3JvbGxPcHRpb25zLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudCxcbiAgICAgICAgcGFnZVNjcm9sbE9wdGlvbnMuZG9jdW1lbnQuYm9keSxcbiAgICAgICAgcGFnZVNjcm9sbE9wdGlvbnMuZG9jdW1lbnQuYm9keS5wYXJlbnROb2RlLFxuICAgICAgXTtcbiAgICAgIHRoaXMuaXNJbmxpbmVTY3JvbGxpbmcgPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5pc0lubGluZVNjcm9sbGluZyA9IHRydWU7XG4gICAgfVxuXG4gICAgdGhpcy5wYWdlU2Nyb2xsT3B0aW9ucyA9IHBhZ2VTY3JvbGxPcHRpb25zO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0U2Nyb2xsaW5nVGFyZ2V0UG9zaXRpb24ocGFnZVNjcm9sbE9wdGlvbnM6IFBhZ2VTY3JvbGxPcHRpb25zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUYXJnZXRFbGVtZW50OiBIVE1MRWxlbWVudCk6IHsgdG9wOiBudW1iZXIsIGxlZnQ6IG51bWJlciB9IHtcbiAgICBjb25zdCBib2R5ID0gcGFnZVNjcm9sbE9wdGlvbnMuZG9jdW1lbnQuYm9keTtcbiAgICBjb25zdCBkb2NFbCA9IHBhZ2VTY3JvbGxPcHRpb25zLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcblxuICAgIGNvbnN0IHdpbmRvd1BhZ2VZT2Zmc2V0OiBudW1iZXIgPSBwYWdlU2Nyb2xsT3B0aW9ucy5kb2N1bWVudC5kZWZhdWx0VmlldyAmJlxuICAgICAgcGFnZVNjcm9sbE9wdGlvbnMuZG9jdW1lbnQuZGVmYXVsdFZpZXcucGFnZVlPZmZzZXQgfHwgdW5kZWZpbmVkO1xuICAgIGNvbnN0IHdpbmRvd1BhZ2VYT2Zmc2V0OiBudW1iZXIgPSBwYWdlU2Nyb2xsT3B0aW9ucy5kb2N1bWVudC5kZWZhdWx0VmlldyAmJlxuICAgICAgcGFnZVNjcm9sbE9wdGlvbnMuZG9jdW1lbnQuZGVmYXVsdFZpZXcucGFnZVhPZmZzZXQgfHwgdW5kZWZpbmVkO1xuXG4gICAgY29uc3Qgc2Nyb2xsVG9wID0gd2luZG93UGFnZVlPZmZzZXQgfHwgZG9jRWwuc2Nyb2xsVG9wIHx8IGJvZHkuc2Nyb2xsVG9wO1xuICAgIGNvbnN0IHNjcm9sbExlZnQgPSB3aW5kb3dQYWdlWE9mZnNldCB8fCBkb2NFbC5zY3JvbGxMZWZ0IHx8IGJvZHkuc2Nyb2xsTGVmdDtcblxuICAgIGNvbnN0IGNsaWVudFRvcCA9IGRvY0VsLmNsaWVudFRvcCB8fCBib2R5LmNsaWVudFRvcCB8fCAwO1xuICAgIGNvbnN0IGNsaWVudExlZnQgPSBkb2NFbC5jbGllbnRMZWZ0IHx8IGJvZHkuY2xpZW50TGVmdCB8fCAwO1xuXG4gICAgaWYgKHNjcm9sbFRhcmdldEVsZW1lbnQgPT09IHVuZGVmaW5lZCB8fCBzY3JvbGxUYXJnZXRFbGVtZW50ID09PSBudWxsKSB7XG4gICAgICAvLyBObyBlbGVtZW50IGZvdW5kLCBzbyByZXR1cm4gdGhlIGN1cnJlbnQgcG9zaXRpb24gdG8gbm90IGNhdXNlIGFueSBjaGFuZ2UgaW4gc2Nyb2xsIHBvc2l0aW9uXG4gICAgICByZXR1cm4ge3RvcDogc2Nyb2xsVG9wLCBsZWZ0OiBzY3JvbGxMZWZ0fTtcbiAgICB9XG4gICAgY29uc3QgYm94ID0gc2Nyb2xsVGFyZ2V0RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIGNvbnN0IHRvcCA9IGJveC50b3AgKyBzY3JvbGxUb3AgLSBjbGllbnRUb3A7XG4gICAgY29uc3QgbGVmdCA9IGJveC5sZWZ0ICsgc2Nyb2xsTGVmdCAtIGNsaWVudExlZnQ7XG5cbiAgICByZXR1cm4ge3RvcDogTWF0aC5yb3VuZCh0b3ApLCBsZWZ0OiBNYXRoLnJvdW5kKGxlZnQpfTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIGdldElubGluZVNjcm9sbGluZ1RhcmdldFBvc2l0aW9uKHBhZ2VTY3JvbGxPcHRpb25zOiBQYWdlU2Nyb2xsT3B0aW9ucyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVGFyZ2V0RWxlbWVudDogSFRNTEVsZW1lbnQpOiB7IHRvcDogbnVtYmVyLCBsZWZ0OiBudW1iZXIgfSB7XG4gICAgY29uc3QgcG9zaXRpb24gPSB7dG9wOiBzY3JvbGxUYXJnZXRFbGVtZW50Lm9mZnNldFRvcCwgbGVmdDogc2Nyb2xsVGFyZ2V0RWxlbWVudC5vZmZzZXRMZWZ0fTtcbiAgICBpZiAocGFnZVNjcm9sbE9wdGlvbnMuYWR2YW5jZWRJbmxpbmVPZmZzZXRDYWxjdWxhdGlvbiAmJiBwYWdlU2Nyb2xsT3B0aW9ucy5zY3JvbGxWaWV3cy5sZW5ndGggPT09IDEpIHtcbiAgICAgIGNvbnN0IGFjY3VtdWxhdGVkUGFyZW50c1BvcyA9IHt0b3A6IDAsIGxlZnQ6IDB9O1xuICAgICAgLy8gbm90IG5hbWVkIHdpbmRvdyB0byBtYWtlIHN1cmUgd2UncmUgbm90IGdldHRpbmcgdGhlIGdsb2JhbCB3aW5kb3cgdmFyaWFibGUgYnkgYWNjaWRlbnRcbiAgICAgIGNvbnN0IHRoZVdpbmRvdyA9IHNjcm9sbFRhcmdldEVsZW1lbnQub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldztcbiAgICAgIGxldCBwYXJlbnRGb3VuZCA9IGZhbHNlO1xuXG4gICAgICAvLyBTdGFydCBwYXJlbnQgaXMgdGhlIGltbWVkaWF0ZSBwYXJlbnRcbiAgICAgIGxldCBwYXJlbnQgPSBzY3JvbGxUYXJnZXRFbGVtZW50LnBhcmVudEVsZW1lbnQ7XG5cbiAgICAgIC8vIEl0ZXJhdGUgdXB3YXJkcyBhbGwgcGFyZW50c1xuICAgICAgd2hpbGUgKCFwYXJlbnRGb3VuZCAmJiBwYXJlbnQgIT09IHVuZGVmaW5lZCAmJiBwYXJlbnQgIT09IG51bGwpIHtcbiAgICAgICAgaWYgKHRoZVdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHBhcmVudCkuZ2V0UHJvcGVydHlWYWx1ZSgncG9zaXRpb24nKSA9PT0gJ3JlbGF0aXZlJykge1xuICAgICAgICAgIGFjY3VtdWxhdGVkUGFyZW50c1Bvcy50b3AgKz0gcGFyZW50Lm9mZnNldFRvcDtcbiAgICAgICAgICBhY2N1bXVsYXRlZFBhcmVudHNQb3MubGVmdCArPSBwYXJlbnQub2Zmc2V0TGVmdDtcbiAgICAgICAgfVxuICAgICAgICAvLyBOZXh0IGl0ZXJhdGlvblxuICAgICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50RWxlbWVudDtcbiAgICAgICAgcGFyZW50Rm91bmQgPSBwYXJlbnQgPT09IHBhZ2VTY3JvbGxPcHRpb25zLnNjcm9sbFZpZXdzWzBdO1xuICAgICAgfVxuICAgICAgaWYgKHBhcmVudEZvdW5kKSB7XG4gICAgICAgIC8vIE9ubHkgdXNlIHRoZSByZXN1bHRzIGlmIHdlIGZvdW5kIHRoZSBwYXJlbnQsIG90aGVyd2lzZSB3ZSBhY2N1bXVsYXRlZCB0b28gbXVjaCBhbnl3YXlcbiAgICAgICAgcG9zaXRpb24udG9wICs9IGFjY3VtdWxhdGVkUGFyZW50c1Bvcy50b3A7XG4gICAgICAgIHBvc2l0aW9uLmxlZnQgKz0gYWNjdW11bGF0ZWRQYXJlbnRzUG9zLmxlZnQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvKiBUT0RPIFVuY29tbWVudFxuICAgICAgICBpZiAoUGFnZVNjcm9sbENvbmZpZy5fbG9nTGV2ZWwgPj0gMiB8fCAoUGFnZVNjcm9sbENvbmZpZy5fbG9nTGV2ZWwgPj0gMSAmJiBpc0Rldk1vZGUoKSkpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ1VuYWJsZSB0byBmaW5kIG5lc3RlZCBzY3JvbGxpbmcgdGFyZ2V0cyBwYXJlbnQhJyk7XG4gICAgICAgIH0qL1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBwb3NpdGlvbjtcbiAgfVxuXG4gIHB1YmxpYyBnZXRTY3JvbGxQcm9wZXJ0eVZhbHVlKHNjcm9sbGluZ1ZpZXc6IGFueSk6IG51bWJlciB7XG4gICAgaWYgKCF0aGlzLnBhZ2VTY3JvbGxPcHRpb25zLnZlcnRpY2FsU2Nyb2xsaW5nKSB7XG4gICAgICByZXR1cm4gc2Nyb2xsaW5nVmlldy5zY3JvbGxMZWZ0O1xuICAgIH1cblxuICAgIHJldHVybiBzY3JvbGxpbmdWaWV3LnNjcm9sbFRvcDtcbiAgfVxuXG4gIHB1YmxpYyBnZXRTY3JvbGxDbGllbnRQcm9wZXJ0eVZhbHVlKHNjcm9sbGluZ1ZpZXc6IGFueSk6IG51bWJlciB7XG4gICAgaWYgKCF0aGlzLnBhZ2VTY3JvbGxPcHRpb25zLnZlcnRpY2FsU2Nyb2xsaW5nKSB7XG4gICAgICByZXR1cm4gc2Nyb2xsaW5nVmlldy5jbGllbnRXaWR0aDtcbiAgICB9XG5cbiAgICByZXR1cm4gc2Nyb2xsaW5nVmlldy5jbGllbnRIZWlnaHQ7XG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdCB0aGUgZXhhY3QgbG9jYXRpb24gb2YgdGhlIHNjcm9sbFRhcmdldCBlbGVtZW50LlxuICAgKlxuICAgKiBFeHRyYWN0IHRoZSBzY3JvbGxUYXJnZXQgSFRNTEVsZW1lbnQgZnJvbSB0aGUgZ2l2ZW4gUGFnZVNjcm9sbFRhcmdldCBvYmplY3QuIFRoZSBsYXR0ZXIgb25lIG1heSBiZVxuICAgKiBhIHN0cmluZyBsaWtlIFwiI2hlYWRpbmcyXCIsIHRoZW4gdGhpcyBtZXRob2QgcmV0dXJucyB0aGUgY29ycmVzcG9uZGluZyBET00gZWxlbWVudCBmb3IgdGhhdCBpZC5cbiAgICpcbiAgICovXG4gIHB1YmxpYyBleHRyYWN0U2Nyb2xsVGFyZ2V0UG9zaXRpb24oKTogeyB0b3A6IG51bWJlciwgbGVmdDogbnVtYmVyIH0ge1xuICAgIGNvbnN0IHNjcm9sbFRhcmdldEVsZW1lbnQgPSB0aGlzLmdldFNjcm9sbFRhcmdldEVsZW1lbnQoKTtcblxuICAgIGlmIChzY3JvbGxUYXJnZXRFbGVtZW50ID09PSBudWxsIHx8IHNjcm9sbFRhcmdldEVsZW1lbnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gU2Nyb2xsIHRhcmdldCBub3QgZm91bmRcbiAgICAgIHJldHVybiB7dG9wOiBOYU4sIGxlZnQ6IE5hTn07XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNJbmxpbmVTY3JvbGxpbmcpIHtcbiAgICAgIHJldHVybiBQYWdlU2Nyb2xsSW5zdGFuY2UuZ2V0SW5saW5lU2Nyb2xsaW5nVGFyZ2V0UG9zaXRpb24odGhpcy5wYWdlU2Nyb2xsT3B0aW9ucywgc2Nyb2xsVGFyZ2V0RWxlbWVudCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFBhZ2VTY3JvbGxJbnN0YW5jZS5nZXRTY3JvbGxpbmdUYXJnZXRQb3NpdGlvbih0aGlzLnBhZ2VTY3JvbGxPcHRpb25zLCBzY3JvbGxUYXJnZXRFbGVtZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRvcCBvZmZzZXQgb2YgdGhlIHNjcm9sbCBhbmltYXRpb24uXG4gICAqIFRoaXMgYXV0b21hdGljYWxseSB0YWtlcyB0aGUgb2Zmc2V0IGxvY2F0aW9uIG9mIHRoZSBzY3JvbGxpbmcgY29udGFpbmVyL3Njcm9sbGluZyB2aWV3XG4gICAqIGludG8gYWNjb3VudCAoZm9yIG5lc3RlZC9pbmxpbmUgc2Nyb2xsaW5nKS5cbiAgICovXG4gIHB1YmxpYyBnZXRDdXJyZW50T2Zmc2V0KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMucGFnZVNjcm9sbE9wdGlvbnMuc2Nyb2xsT2Zmc2V0O1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIFwic2Nyb2xsVG9wXCIgb3IgXCJzY3JvbGxMZWZ0XCIgcHJvcGVydHkgZm9yIGFsbCBzY3JvbGxWaWV3cyB0byB0aGUgcHJvdmlkZWQgdmFsdWVcbiAgICogQHJldHVybiB0cnVlIGlmIGF0IGxlYXN0IGZvciBvbmUgU2Nyb2xsVG9wU291cmNlIHRoZSBzY3JvbGxUb3Avc2Nyb2xsTGVmdCB2YWx1ZSBjb3VsZCBiZSBzZXQgYW5kIGl0IGtlcHQgdGhlIG5ldyB2YWx1ZS5cbiAgICogICAgICAgICAgZmFsc2UgaWYgaXQgZmFpbGVkIGZvciBhbGwgU2Nyb2xsVmlld3MsIG1lYW5pbmcgdGhhdCB3ZSBzaG91bGQgc3RvcCB0aGUgYW5pbWF0aW9uXG4gICAqICAgICAgICAgIChwcm9iYWJseSBiZWNhdXNlIHdlJ3JlIGF0IHRoZSBlbmQgb2YgdGhlIHNjcm9sbGluZyByZWdpb24pXG4gICAqL1xuICBwdWJsaWMgc2V0U2Nyb2xsUG9zaXRpb24ocG9zaXRpb246IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIC8vIFNldCB0aGUgbmV3IHNjcm9sbFRvcC9zY3JvbGxMZWZ0IHRvIGFsbCBzY3JvbGxWaWV3cyBlbGVtZW50c1xuICAgIHJldHVybiB0aGlzLnBhZ2VTY3JvbGxPcHRpb25zLnNjcm9sbFZpZXdzLnJlZHVjZSgob25lQWxyZWFkeVdvcmtlZDogYW55LCBzY3JvbGxpbmdWaWV3OiBhbnkpID0+IHtcbiAgICAgIGNvbnN0IHN0YXJ0U2Nyb2xsUHJvcGVydHlWYWx1ZSA9IHRoaXMuZ2V0U2Nyb2xsUHJvcGVydHlWYWx1ZShzY3JvbGxpbmdWaWV3KTtcbiAgICAgIGlmIChzY3JvbGxpbmdWaWV3ICYmIHN0YXJ0U2Nyb2xsUHJvcGVydHlWYWx1ZSAhPT0gdW5kZWZpbmVkICYmIHN0YXJ0U2Nyb2xsUHJvcGVydHlWYWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICBjb25zdCBzY3JvbGxEaXN0YW5jZSA9IE1hdGguYWJzKHN0YXJ0U2Nyb2xsUHJvcGVydHlWYWx1ZSAtIHBvc2l0aW9uKTtcblxuICAgICAgICAvLyBUaGUgbW92ZW1lbnQgd2UgbmVlZCB0byBwZXJmb3JtIGlzIGxlc3MgdGhhbiAycHhcbiAgICAgICAgLy8gVGhpcyB3ZSBjb25zaWRlciBhIHNtYWxsIG1vdmVtZW50IHdoaWNoIHNvbWUgYnJvd3NlciBtYXkgbm90IHBlcmZvcm0gd2hlblxuICAgICAgICAvLyBjaGFuZ2luZyB0aGUgc2Nyb2xsVG9wL3Njcm9sbExlZnQgcHJvcGVydHlcbiAgICAgICAgLy8gVGh1cyBpbiB0aGlzIGNhc2VzIHdlIGRvIG5vdCBzdG9wIHRoZSBzY3JvbGwgYW5pbWF0aW9uLCBhbHRob3VnaCBzZXR0aW5nIHRoZVxuICAgICAgICAvLyBzY3JvbGxUb3Avc2Nyb2xsTGVmdCB2YWx1ZSBcImZhaWxzXCJcbiAgICAgICAgY29uc3QgaXNTbWFsbE1vdmVtZW50ID0gc2Nyb2xsRGlzdGFuY2UgPCB0aGlzLnBhZ2VTY3JvbGxPcHRpb25zLl9taW5TY3JvbGxEaXN0YW5jZTtcblxuICAgICAgICBpZiAoIXRoaXMucGFnZVNjcm9sbE9wdGlvbnMudmVydGljYWxTY3JvbGxpbmcpIHtcbiAgICAgICAgICBzY3JvbGxpbmdWaWV3LnNjcm9sbExlZnQgPSBwb3NpdGlvbjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzY3JvbGxpbmdWaWV3LnNjcm9sbFRvcCA9IHBvc2l0aW9uO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmV0dXJuIHRydWUgaWYgc2V0dGluZyB0aGUgbmV3IHNjcm9sbFRvcC9zY3JvbGxMZWZ0IHZhbHVlIHdvcmtlZFxuICAgICAgICAvLyBXZSBjb25zaWRlciB0aGF0IGl0IHdvcmtlZCBpZiB0aGUgbmV3IHNjcm9sbFRvcC9zY3JvbGxMZWZ0IHZhbHVlIGlzIGNsb3NlciB0byB0aGVcbiAgICAgICAgLy8gZGVzaXJlZCBzY3JvbGxUb3Avc2Nyb2xsTGVmdCB0aGFuIGJlZm9yZSAoaXQgbWlnaHQgbm90IGJlIGV4YWN0bHkgdGhlIHZhbHVlIHdlXG4gICAgICAgIC8vIHNldCBkdWUgdG8gZHBpIG9yIHJvdW5kaW5nIGlycmVndWxhcml0aWVzKVxuICAgICAgICBpZiAoaXNTbWFsbE1vdmVtZW50IHx8IHNjcm9sbERpc3RhbmNlID4gTWF0aC5hYnModGhpcy5nZXRTY3JvbGxQcm9wZXJ0eVZhbHVlKHNjcm9sbGluZ1ZpZXcpIC0gcG9zaXRpb24pKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG9uZUFscmVhZHlXb3JrZWQ7XG4gICAgfSwgZmFsc2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRyaWdnZXIgZmlyaW5nIGEgYW5pbWF0aW9uIGZpbmlzaCBldmVudFxuICAgKiBAcGFyYW0gdmFsdWUgV2hldGhlciB0aGUgYW5pbWF0aW9uIGZpbmlzaGVkIGF0IHRoZSB0YXJnZXQgKHRydWUpIG9yIGdvdCBpbnRlcnJ1cHRlZCAoZmFsc2UpXG4gICAqL1xuICBwdWJsaWMgZmlyZUV2ZW50KHZhbHVlOiBib29sZWFuKTogdm9pZCB7XG4gICAgaWYgKHRoaXMucGFnZVNjcm9sbE9wdGlvbnMuc2Nyb2xsRmluaXNoTGlzdGVuZXIpIHtcbiAgICAgIHRoaXMucGFnZVNjcm9sbE9wdGlvbnMuc2Nyb2xsRmluaXNoTGlzdGVuZXIuZW1pdCh2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEF0dGFjaCB0aGUgaW50ZXJydXB0IGxpc3RlbmVycyB0byB0aGUgUGFnZVNjcm9sbEluc3RhbmNlIGJvZHkuIFRoZSBnaXZlbiBpbnRlcnJ1cHRSZXBvcnRlclxuICAgKiB3aWxsIGJlIGNhbGxlZCBpZiBhbnkgb2YgdGhlIGF0dGFjaGVkIGV2ZW50cyBpcyBmaXJlZC5cbiAgICpcbiAgICogUG9zc2libHkgYXR0YWNoZWQgaW50ZXJydXB0TGlzdGVuZXJzIGFyZSBhdXRvbWF0aWNhbGx5IHJlbW92ZWQgZnJvbSB0aGUgYm9keSBiZWZvcmUgdGhlIG5ldyBvbmUgd2lsbCBiZSBhdHRhY2hlZC5cbiAgICovXG4gIHB1YmxpYyBhdHRhY2hJbnRlcnJ1cHRMaXN0ZW5lcnMoaW50ZXJydXB0UmVwb3J0ZXI6IEludGVycnVwdFJlcG9ydGVyKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaW50ZXJydXB0TGlzdGVuZXJzQXR0YWNoZWQpIHtcbiAgICAgIC8vIERldGFjaCBwb3NzaWJseSBleGlzdGluZyBsaXN0ZW5lcnMgZmlyc3RcbiAgICAgIHRoaXMuZGV0YWNoSW50ZXJydXB0TGlzdGVuZXJzKCk7XG4gICAgfVxuICAgIHRoaXMuaW50ZXJydXB0TGlzdGVuZXIgPSAoZXZlbnQ6IEV2ZW50KTogdm9pZCA9PiB7XG4gICAgICBpbnRlcnJ1cHRSZXBvcnRlci5yZXBvcnQoZXZlbnQsIHRoaXMpO1xuICAgIH07XG4gICAgdGhpcy5wYWdlU2Nyb2xsT3B0aW9ucy5pbnRlcnJ1cHRFdmVudHMuZm9yRWFjaChcbiAgICAgIChldmVudDogc3RyaW5nKSA9PiB0aGlzLnBhZ2VTY3JvbGxPcHRpb25zLmRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgdGhpcy5pbnRlcnJ1cHRMaXN0ZW5lcilcbiAgICApO1xuICAgIHRoaXMuaW50ZXJydXB0TGlzdGVuZXJzQXR0YWNoZWQgPSB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBldmVudCBsaXN0ZW5lcnMgZnJvbSB0aGUgYm9keSBhbmQgc3RvcCBsaXN0ZW5pbmcgZm9yIGV2ZW50cyB0aGF0IG1pZ2h0IGJlIHRyZWF0ZWQgYXMgXCJhbmltYXRpb25cbiAgICogaW50ZXJydXB0XCIgZXZlbnRzLlxuICAgKi9cbiAgcHVibGljIGRldGFjaEludGVycnVwdExpc3RlbmVycygpOiB2b2lkIHtcbiAgICB0aGlzLnBhZ2VTY3JvbGxPcHRpb25zLmludGVycnVwdEV2ZW50cy5mb3JFYWNoKFxuICAgICAgKGV2ZW50OiBzdHJpbmcpID0+IHRoaXMucGFnZVNjcm9sbE9wdGlvbnMuZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCB0aGlzLmludGVycnVwdExpc3RlbmVyKVxuICAgICk7XG4gICAgdGhpcy5pbnRlcnJ1cHRMaXN0ZW5lcnNBdHRhY2hlZCA9IGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTY3JvbGxUYXJnZXRFbGVtZW50KCk6IEhUTUxFbGVtZW50IHtcbiAgICBpZiAodHlwZW9mIHRoaXMucGFnZVNjcm9sbE9wdGlvbnMuc2Nyb2xsVGFyZ2V0ID09PSAnc3RyaW5nJykge1xuICAgICAgY29uc3QgdGFyZ2V0U2VsZWN0b3IgPSA8c3RyaW5nPnRoaXMucGFnZVNjcm9sbE9wdGlvbnMuc2Nyb2xsVGFyZ2V0O1xuICAgICAgaWYgKHRhcmdldFNlbGVjdG9yLm1hdGNoKC9eI1teXFxzXSskL2cpICE9PSBudWxsKSB7XG4gICAgICAgIC8vIEl0J3MgYW4gaWQgc2VsZWN0b3IgYW5kIGEgdmFsaWQgaWQsIGFzIGl0IGRvZXMgbm90IGNvbnRhaW4gYW55IHdoaXRlIHNwYWNlIGNoYXJhY3RlcnNcblxuICAgICAgICByZXR1cm4gdGhpcy5wYWdlU2Nyb2xsT3B0aW9ucy5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0YXJnZXRTZWxlY3Rvci5zdWJzdHIoMSkpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gPEhUTUxFbGVtZW50PnRoaXMucGFnZVNjcm9sbE9wdGlvbnMuZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0YXJnZXRTZWxlY3Rvcik7XG4gICAgfVxuXG4gICAgcmV0dXJuIDxIVE1MRWxlbWVudD50aGlzLnBhZ2VTY3JvbGxPcHRpb25zLnNjcm9sbFRhcmdldDtcbiAgfVxufVxuXG4vKipcbiAqIEFuIEludGVyZmFjZSBhIGxpc3RlbmVyIHNob3VsZCBpbXBsZW1lbnQgdG8gYmUgbm90aWZpZWQgYWJvdXQgcG9zc2libGUgaW50ZXJydXB0IGV2ZW50c1xuICogdGhhdCBoYXBwZW5lZCBkdWUgdG8gdXNlciBpbnRlcmFjdGlvbiB3aGlsZSBhIHNjcm9sbCBhbmltYXRpb24gdGFrZXMgcGxhY2UuXG4gKlxuICogVGhlIFBhZ2VTY3JvbGxTZXJ2aWNlIHByb3ZpZGVzIGFuIGltcGxlbWVudGF0aW9uIHRvIGEgUGFnZVNjcm9sbEluc3RhbmNlIHRvIGJlIG5vdGlmaWVkXG4gKiBhYm91dCBzY3JvbGwgYW5pbWF0aW9uIGludGVycnVwdHMgYW5kIHN0b3AgcmVsYXRlZCBhbmltYXRpb25zLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEludGVycnVwdFJlcG9ydGVyIHtcbiAgcmVwb3J0KGV2ZW50OiBFdmVudCwgcGFnZVNjcm9sbEluc3RhbmNlOiBQYWdlU2Nyb2xsSW5zdGFuY2UpOiB2b2lkO1xufVxuIl19