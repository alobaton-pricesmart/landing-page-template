{"version":3,"file":"chat-form.component.js","sourceRoot":"","sources":["../../../../../../.ng_build/theme/components/chat/chat-form.component.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Akveo. All Rights Reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n */\n\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  HostBinding,\n  HostListener,\n  Input,\n  Output,\n} from '@angular/core';\nimport { DomSanitizer } from '@angular/platform-browser';\n\nimport { NbComponentStatus } from '../component-status';\n\n/**\n * Chat form component.\n *\n * Show a message form with a send message button.\n *\n * ```ts\n * <nb-chat-form showButton=\"true\" buttonIcon=\"nb-send\">\n * </nb-chat-form>\n * ```\n *\n * When `[dropFiles]=\"true\"` handles files drag&drop with a file preview.\n *\n * Drag & drop available for files and images:\n * @stacked-example(Drag & Drop Chat, chat/chat-drop.component)\n *\n * New message could be tracked outside by using `(send)` output.\n *\n * ```ts\n * <nb-chat-form (send)=\"onNewMessage($event)\">\n * </nb-chat-form>\n *\n * // ...\n *\n * onNewMessage({ message: string, files: any[] }) {\n *   this.service.sendToServer(message, files);\n * }\n * ```\n */\n@Component({\n  selector: 'nb-chat-form',\n  template: `\n    <div class=\"dropped-files\" *ngIf=\"droppedFiles?.length\">\n      <ng-container *ngFor=\"let file of droppedFiles\">\n        <div *ngIf=\"file.urlStyle\" [style.background-image]=\"file.urlStyle\">\n          <span class=\"remove\" (click)=\"removeFile(file)\">&times;</span>\n        </div>\n\n        <div>\n          <nb-icon *ngIf=\"!file.urlStyle\" icon=\"file-text-outline\" pack=\"nebular-essentials\"></nb-icon>\n          <span class=\"remove\" (click)=\"removeFile(file)\">&times;</span>\n        </div>\n      </ng-container>\n    </div>\n    <div class=\"message-row\">\n      <input nbInput\n             fullWidth\n             [status]=\"getInputStatus()\"\n             (focus)=\"inputFocus = true\"\n             (blur)=\"inputFocus = false\"\n             (mouseenter)=\"inputHover = true\"\n             (mouseleave)=\"inputHover = false\"\n             [(ngModel)]=\"message\"\n             [class.with-button]=\"showButton\"\n             type=\"text\"\n             placeholder=\"{{ fileOver ? 'Drop file to send' : 'Type a message' }}\"\n             (keyup.enter)=\"sendMessage()\">\n      <button nbButton\n              [status]=\"getButtonStatus()\"\n              *ngIf=\"showButton\"\n              [class.with-icon]=\"!buttonTitle\"\n              (click)=\"sendMessage()\"\n              class=\"send-button\">\n        <nb-icon *ngIf=\"!buttonTitle; else title\" [icon]=\"buttonIcon\" pack=\"nebular-essentials\"></nb-icon>\n        <ng-template #title>{{ buttonTitle }}</ng-template>\n      </button>\n    </div>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class NbChatFormComponent {\n\n  status: NbComponentStatus = 'basic';\n  inputFocus: boolean = false;\n  inputHover: boolean = false;\n\n  droppedFiles: any[] = [];\n  imgDropTypes = ['image/png', 'image/jpeg', 'image/gif'];\n\n  /**\n   * Predefined message text\n   * @type {string}\n   */\n  @Input() message: string = '';\n\n  /**\n   * Send button title\n   * @type {string}\n   */\n  @Input() buttonTitle: string = '';\n\n  /**\n   * Send button icon, shown if `buttonTitle` is empty\n   * @type {string}\n   */\n  @Input() buttonIcon: string = 'paper-plane-outline';\n\n  /**\n   * Show send button\n   * @type {boolean}\n   */\n  @Input() showButton: boolean = true;\n\n  /**\n   * Show send button\n   * @type {boolean}\n   */\n  @Input() dropFiles: boolean = false;\n\n  /**\n   *\n   * @type {EventEmitter<{ message: string, files: File[] }>}\n   */\n  @Output() send = new EventEmitter<{ message: string, files: File[] }>();\n\n  @HostBinding('class.file-over') fileOver = false;\n\n  constructor(protected cd: ChangeDetectorRef, protected domSanitizer: DomSanitizer) {\n  }\n\n  @HostListener('drop', ['$event'])\n  onDrop(event: any) {\n    if (this.dropFiles) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      this.fileOver = false;\n      if (event.dataTransfer && event.dataTransfer.files) {\n\n        for (const file of event.dataTransfer.files) {\n          const res = file;\n\n          if (this.imgDropTypes.includes(file.type)) {\n            const fr = new FileReader();\n            fr.onload = (e: any) => {\n              res.src = e.target.result;\n              res.urlStyle = this.domSanitizer.bypassSecurityTrustStyle(`url(${res.src})`);\n              this.cd.detectChanges();\n            };\n\n            fr.readAsDataURL(file);\n          }\n          this.droppedFiles.push(res);\n        }\n      }\n    }\n  }\n\n  removeFile(file) {\n    const index = this.droppedFiles.indexOf(file);\n    if (index >= 0) {\n      this.droppedFiles.splice(index, 1);\n    }\n  }\n\n  @HostListener('dragover')\n  onDragOver() {\n    if (this.dropFiles) {\n      this.fileOver = true;\n    }\n  }\n\n  @HostListener('dragleave')\n  onDragLeave() {\n    if (this.dropFiles) {\n      this.fileOver = false;\n    }\n  }\n\n  sendMessage() {\n    if (this.droppedFiles.length || String(this.message).trim().length) {\n      this.send.emit({ message: this.message, files: this.droppedFiles });\n      this.message = '';\n      this.droppedFiles = [];\n    }\n  }\n\n  setStatus(status: NbComponentStatus): void {\n    if (this.status !== status) {\n      this.status = status;\n      this.cd.detectChanges();\n    }\n  }\n\n  getInputStatus(): NbComponentStatus {\n    if (this.fileOver) {\n      return this.getHighlightStatus();\n    }\n\n    if (this.inputFocus || this.inputHover) {\n      return this.status;\n    }\n\n    return 'basic';\n  }\n\n  getButtonStatus(): NbComponentStatus {\n    return this.getHighlightStatus();\n  }\n\n  protected getHighlightStatus(): NbComponentStatus {\n    if (this.status === 'basic' || this.status === 'control') {\n      return 'primary';\n    }\n\n    return this.status;\n  }\n}\n"]}